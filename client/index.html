<html>
<head>
<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>

<link rel="stylesheet" type="text/css" href="/client/css.css">
</head>
<body>
  <h1 id="turnstatus">TURN</h1>
<div id="mid">
  <div id="pot">
    <img id="backcard" onclick="Kopen()" src="/client/img/BACK.png"/>
  </div>
  <div id="game">
    <img id="gamepile" src="/client/img/EMPTY.png"/>
  </div>
</div>
<div id="hand"></div>

<button onclick="Readyup()" id="readyButton">Ready</button>
<button onclick="Status()" id="statusButton">Status</button>
<button onclick="PassTurn()" id="passButton">Klaar</button>


<div id="boerkeuze">
  <div id="middenkeuze">
    <form>
      <input class="radio" type="radio" name="boer"> Harten</input><br>
      <input class="radio" type="radio" name="boer"> Ruiten</input><br>
      <input class="radio" type="radio" name="boer"> Schoppen</input><br>
      <input class="radio" type="radio" name="boer"> Klaver</input><br>
      <input type="submit" value="Maak keuze"></input>
    </form>
  </div>
</div>

<script>
  localStorage.setItem("gekocht", "0");
  var socket = io();
  turn = 0;

  socket.on('connect', function() {
    var sessionid = socket.id;
    localStorage.setItem("sessionid", sessionid);
  })



  socket.on('userdisconnect', function(){
    alert("Er is een speler gedisconnect. refresh de server");
  });
  socket.on('hand', function(hand){
    console.log("kaarten gekregen");
      var node = document.getElementById("hand");
      node.innerHTML = '';
    for(var i=0; i < hand.length; i++){
      var subnode = document.createElement("a");
      subnode.setAttribute("class", "card");
      subnode.setAttribute("name", i);
      subnode.setAttribute("id", i);
      subnode.setAttribute("onclick", "PickCard(getAttribute('name'))")
      var textnode = document.createTextNode(hand[i]);
      var image = document.createElement("img");
      image.setAttribute("src", "/client/img/" + hand[i] + ".png");
      subnode.appendChild(image);
      node.appendChild(subnode);
      //node.appendChild(document.createElement("br"));
    }
  });

  socket.on("handchange", function(data){
    var hand = document.getElementById("hand");
    hand.removeChild(document.getElementById(data.card))
    var handlength = hand.childElementCount;
    for(var i=0; i < handlength; i++){
      thiscard = hand.children[i];
      thiscard.setAttribute("name", i);
      thiscard.setAttribute("id", i);
    }

      haviwon();
  })

  // socket.on("you won", function(){
  //     console.log("GEWONNEN");
  //   var turnstatus= document.getElementById("turnstatus");
  //   turnstatus.innerHTML = "Je hebt gewonnen!";
  // });
  //
  //
  // socket.on("you lost", function(){
  //     console.log("VERLOREN");
  //     var turnstatus= document.getElementById("turnstatus");
  //     turnstatus.innerHTML = "Je hebt verloren";
  // });
      socket.on("finished", function(data){
        console.log(String(localStorage.getItem("sessionid")));
        console.log(data.winner);
        if(String(localStorage.getItem("sessionid")) == data.winner){
          console.log("GEWONNEN");
        }
        else{
          console.log("VERLOREN");
        }
      })

      socket.on("loser"){
        console.log("LOST");
      }


            socket.on("winner"){
              console.log("WON");
            }



  socket.on("topstackchange", function(data){
    console.log("topstackchange");
    var stapel = document.getElementById("gamepile");
    stapel.setAttribute("src", "/client/img/" + data.topstapel + ".png");

      haviwon();
  });

  socket.on('yourturn', function(){
    console.log("RECEIVED YOURTURN");
    var turnstatus= document.getElementById("turnstatus");
    turnstatus.innerHTML = "Je bent aan de beurt";
    turn = 1;
    localStorage.setItem('turn', '1');
    console.log(localStorage.getItem('turn'));
    console.log("==========================");

  });

  socket.on("eerst kaarten pakken", function(data){
    var turnstatus= document.getElementById("turnstatus");
    if(localStorage.getItem("turn") == '1'){
    setTimeout(function(){
      turnstatus.innerHTML = "Je bent aan de beurt";
    }, 2000);
    }
    else{
      setTimeout(function(){
        turnstatus.innerHTML = "Wacht op je beurt";
      }, 2000);
    }
    turnstatus.innerHTML = "Je moet eerst " + data.amount + " kaart(en) kopen";
  });


  socket.on("skip", function(){
    skip()

  });

  socket.on('right', function(){
    haviwon();
  });

  socket.on('wrong', function(){
    var turnstatus= document.getElementById("turnstatus");
    if(localStorage.getItem("turn") == '1'){
    setTimeout(function(){
      turnstatus.innerHTML = "Je bent aan de beurt";
    }, 2000);
    }
    else{
      setTimeout(function(){
        turnstatus.innerHTML = "Wacht op je beurt";
      }, 2000);
    }
    turnstatus.innerHTML = "Deze kaart kan niet op de stapel";
  });

  socket.on('Boerchoice', function(){
    document.getElementById("boerkeuze").style.display = "block";
    document.getElementById("boerkeuze").style.zIndex = "10";
  });

  socket.on('notyou', function(turn){
    console.log("NOTYOU")
    var turnstatus = document.getElementById("turnstatus");
    turnstatus.innerHTML= "Wacht op je beurt";
    turn = 0;
    localStorage.setItem('turn', '0');
    console.log(localStorage.getItem('turn'));
  });

};
  skip = function(){
    var turnstatus= document.getElementById("turnstatus");
    setTimeout(function(){
      turnstatus.innerHTML = "Wacht op je beurt";
    }, 2000);
    turnstatus.innerHTML = "Je wordt overgeslagen";
  };

  PickCard = function(Cname){
    var turn = localStorage.getItem('turn')
    console.log(turn);
    if(turn == '1'){
      console.log("card selected : " + Cname);
      socket.emit('selectedcard', {
        card: Cname
      });
    }
    else{
      console.log("Het is niet jouw beurt!");
    }
  };

  Readyup = function(){
    socket.emit('ready', {
      status: 1
    });
  };

  Status = function(){
    console.log('statuscall');
    socket.emit('status', {
      status: "call"
    });
  };

  PassTurn = function(){
    console.log("passturn");
    gekocht = localStorage.getItem("gekocht");
    if(gekocht == true){
      console.log('PASSING TURN YEAH')
      socket.emit('passturn');
      localStorage.setItem("gekocht", "0");
    }
    else{
      console.log("FUCK YOU BUY CARD")
      var turnstatus= document.getElementById("turnstatus");
      if(localStorage.getItem("turn") == '1'){
      setTimeout(function(){
        turnstatus.innerHTML = "Je bent aan de beurt";
      }, 2000);
      }
      else{
        setTimeout(function(){
          turnstatus.innerHTML = "Wacht op je beurt";
        }, 2000);
      }
      turnstatus.innerHTML = "Je moet eerst een kaart van de pot pakken";
    }
  };

  haviwon = function(){
    var hand = document.getElementById("hand");
    var sessionid = localStorage.getItem("sessionid");
    console.log("HAND:    ", hand.childElementCount);
    console.log("SESSIONID:    ", sessionid);
    if (hand.childElementCount == 0) {
      socket.emit("iwon", {
        winner: sessionid
      });
    }
  };

  Kopen = function(){
    console.log("kaarten kopen boi")
    if(localStorage.getItem("turn") == '1'){
      socket.emit("kaartkopen");
      localStorage.setItem("gekocht", '1');
    }
    // if(localStorage.getItem("turn") == '1' && localStorage.getItem("gekocht") != '1'){
    //   socket.emit("kaartkopen");
    //   localStorage.setItem("gekocht", '1');
    // }
    else if(localStorage.getItem("turn") == '1' && localStorage.getItem("gekocht") == '1'){
      var turnstatus= document.getElementById("turnstatus");
      turnstatus.innerHTML = "Je hebt al kaarten gepakt";
      setTimeout(function(){
        turnstatus.innerHTML = "Je bent aan de beurt";
      }, 2000);
    }
    else{
      var turnstatus= document.getElementById("turnstatus");
      turnstatus.innerHTML = "Het is niet jouw beurt";
      setTimeout(function(){
        turnstatus.innerHTML = "Wacht op je beurt";
      }, 2000);
    }
  };

</script>
</body>
</html>
